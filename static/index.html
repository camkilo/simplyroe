<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Realm of Echoes</title>
<style>
    body { font-family: sans-serif; background:#111; color:#eee; margin:0; padding:0;}
    #game { display:grid; grid-template-columns:repeat(10,40px); grid-gap:2px; margin:20px;}
    .tile { width:40px; height:40px; display:flex; align-items:center; justify-content:center;
            background:#222; border:1px solid #333; cursor:pointer; transition:0.2s;}
    .forest { background:green;}
    .water { background:blue;}
    .mountain { background:gray;}
    .desert { background:goldenrod;}
    .player { border:2px solid cyan; animation:pulse 1s infinite;}
    @keyframes pulse {0%{box-shadow:0 0 5px cyan;}50%{box-shadow:0 0 15px cyan;}100%{box-shadow:0 0 5px cyan;}}
</style>
</head>
<body>
<h2 style="text-align:center">Realm of Echoes</h2>
<div id="game"></div>
<div style="text-align:center; margin:10px;">
    <button onclick="gather()">Gather</button>
    <button onclick="craft()">Craft</button>
    <div id="log" style="margin-top:10px;"></div>
</div>

<script>
const size = 10;
let world = [];
let player = {x:0, y:0, inventory:[]};

const biomes = ['forest','water','mountain','desert'];

function initWorld(){
    const game = document.getElementById('game');
    game.innerHTML = '';
    world = [];
    for(let y=0;y<size;y++){
        let row = [];
        for(let x=0;x<size;x++){
            const biome = biomes[Math.floor(Math.random()*biomes.length)];
            row.push(biome);
            const tile = document.createElement('div');
            tile.className = 'tile '+biome;
            tile.id = `tile-${x}-${y}`;
            tile.onclick = ()=>movePlayer(x,y);
            game.appendChild(tile);
        }
        world.push(row);
    }
    drawPlayer();
}

function drawPlayer(){
    // Remove existing player class
    document.querySelectorAll('.tile').forEach(t=>t.classList.remove('player'));
    document.getElementById(`tile-${player.x}-${player.y}`).classList.add('player');
}

function movePlayer(x,y){
    player.x = x;
    player.y = y;
    drawPlayer();
    logMessage(`Moved to ${world[y][x]} biome.`);
}

function logMessage(msg){
    const log = document.getElementById('log');
    const p = document.createElement('p');
    p.textContent = msg;
    log.prepend(p);
}

// --- Game Actions ---

async function gather(){
    const biome = world[player.y][player.x];
    const res = await fetch(`/gather?x=${player.x}&y=${player.y}&biome=${biome}`);
    const data = await res.json().catch(()=>({msg:"Gather simulated"}));
    player.inventory.push(data.item || "Element");
    logMessage(`Gathered: ${data.item || "an element"} in ${biome}`);
}

async function craft(){
    const res = await fetch(`/craft?inventory=${player.inventory.join(',')}`);
    const data = await res.json().catch(()=>({msg:"Craft simulated"}));
    if(data.item){
        logMessage(`Crafted: ${data.item}`);
        player.inventory = []; // simple reset
    } else {
        logMessage('Crafting failed or simulated');
    }
}

// Initialize
initWorld();
</script>
</body>
</html>
